Логика
Пользователь делает действие.
Коиком посылает действие на сервер.
У игрока появляеться анимация или любое другое визуальное подтверждение того что, запрос на выполнение ушел на сервер.
От сервера приходит ответ.
Заготовленая анимация проигрываеться до конца.

Клик
Запрос
Пре анимация
Ответ
Пост анимация

На примере огненный шар

Клик - применение заклиянания
Запрос - отправляеться зарпос на подтверждение действия
Пре анимация - над протретом начинает образовыватья сфера
Ответ - с сервара приодит разрешение на выполнение
Пост анимация - шар ударяет оппонента, либо анимация откатываеться назад.

Пример с смертетльным блоком.

Клик - кнопка "Далее"
Запрос - Запрос на подсчет результатов блока
Пре анимация - ---
Ответ - описание резултатов сражения
Пост аниация - последоватльное выполнение следующих действий
	- Анимация нанесения повреждений всем целям
	- Анимация ухода лидера или лидеров разгромленной команды
	- Анимация постановки вопроса выбора нового лидера или лидеров

Далее для каждого ушедщего лидера
	Клик - выбор новго Лидера
	Запрос - устновка новго лидера
	Пре анимация - подсветка выбраннорго персонажа и затеменение остальных
	Ответ - подтверждение нвого лидера
	Пост анимация - Устновка нового лидре на место старого

И когда больше никаких запросов нет - Выравнивание карт по сетке.




Во время подсчета с точки зрения стека
	Над всеми камандами вспывлают значки победы или поражения
	Для всех ниндзя поялветься анимация получения повреждения
	Все ниндзя отправляются на кладбище
	Для всех комнда без лидера выбираеться лидер
	Для всех ушедших карт срабатывает тригер смери, для все оставшихся карт, крат на руке, в сброе и чакре срабатывает тригер чужой смерти.

В резулттате подсчета нужен объект вида
	[
		{
			'adWinnerAndLooser' : [
				{pX:pA, zone:attack, team:1, ad:'completeWin'},
				{pX:pB, zone:block,  team:2, ad:'defeat'},
				{pX:pA, zone:attack, team:3, ad:'rewards'},
			],
		},
		{
			'afterWinnerAndLooser' : [],
		},
		{
			'givingDamage' : [
				{card: c104, damage: 1, type: fire},
				{card: c103, damage: 2, type: fire},
				{card: c102, damage: 2, type: fire},
			]
		},
		{
			'afterGivingDamage' : [],
		},
		{
			'damageResult' : [
				{card: c105, result: death},
				{card: c103, result: injured},
			]
		},
		{
			'newLeader' : [
				{team: 5},
			]
		},
		{
			'afterGivingDamage' : [],
		},
		step4 : {
			'retrunToVillage' : all // ну или подоробно для каждого если есть иключения
		}
	]
=======================


         Server    CLient
         ----------------
                <- initGame      Страница полностью загружена.

         C_init ->               Подготавливает связи сервер-клиент для стола. Отсылает S.

                <- imJoined		 Подготовка полносью завешена

     bothIsJoin ->               Собираеться Known и Accrodance для каждого игрока и отсылаеться
     
                <- startDrawHand
                
S_startDrawHand -> 





                                     <- playJutsu
            Actions.preparePlayJutsu
                         "playJutst" ->
                         			    AN.Questions.selectUserForJutsu
                         			    AN.Questions.selectTargetsForJutsu
                         			 <- Answers.selectUserAndTargetForJutsu
      Actions.prepareAddJutsuToStack
                   "addJutsuToStack" -> 
                                        Actions.addJutsuToStack
                                        Actions.moveCardToZone




                                     <- pressNextBtn
                           LoadStack 
                 "prepareStartStack" ->
                                     <- Actions.prepareStartStack






                                     <- "resolveJutsuInStack"
              AN.resolveJutsuInStack
          Action.resolveJutsuInStack
                AnimationPush(spark)
              Actions.moveCardToZone


Mission

2x BBQ M319 (M589)
2x Lunchbox M466
2x Decoding the Message M821
2x The Nara Clan M859
2x Student and Sensei M673
2x After the Battle M777

Jutsu
2x Formation J517
2x Expansion Jutsu: Super Slap! J697
2x  Shikamaru's Judjment J710
2x Formidable Team J890

-----

Mission

2x  Puppet Show M424
2x  A master's death M843
2x Sasori if the Red Sand M375
2x  A Gift M815
2x  Los M633

Jutsu
2x Secret White Move: Chikamatsu's Ten Puppets J504
2x Substitution by puppet J447
2x Wind Scythe jutsu J631
2x WindStyle: Pressure Damage J914
1x Sand burai J100



jpg
1
bg
death
lose
winner

png
51
bg2
chackra
change
damage
deck
discard
earth
fire
H0
H1
heal
increase
lightning
mini-anbu
number1
number2
number3
number4
numberdisable1
numberdisable2
numberdisable3
numberdisable4
permanent
puff
reward
spark
spark2
Symbol
T0
T1
T2
T3
T4
T5
T6
T7
target
uturn
void
water
wind

-----
multer -https://github.com/expressjs/multer
depd - https://github.com/dougwilson/nodejs-depd
body-parser - https://github.com/expressjs/body-parser
busboy - https://github.com/mscdex/busboy
https://github.com/mscdex/dicer
https://github.com/mscdex/streamsearch
https://github.com/substack/node-mkdirp
https://www.npmjs.com/package/bytes
https://www.npmjs.com/package/raw-body
https://github.com/ashtuchkin/iconv-lite
https://github.com/jshttp/on-finished
https://github.com/jonathanong/ee-first
https://github.com/jshttp/media-typer



Стек эффектов и добавление условных эффектов.

Каждая карта техиник занимает одно место в цепочке техник.
Допустим их там три штуки 1, 2, 3
Допустим есть еще какой то эффект который срабатывает между эффектом первой и сторой техники.
Например, текст когото ниндяз добавлет в стек свой эффект, например взять карту.
Куда в этом случае должен добавиться этот эффект.
по идее в конец цепочки и тут же будет рассмотрена так как цепочка рассматривается с конца.

Т.е. в стек будет добавлен эффект.
соотвествеено наш случай схематично можно отбразить так

Стек до начала рассмотрения
эффект_техники_3
Эффект_техники_2
эффект_техники_1

Рассматривает первая техника которая провоцирует эффект ниндзя и тот добавляется в стек. После этого стек должен будет выглядеть следующим образов

эффект_ниндзя_1
эффект_техники_2
эффект_техники_1

Дальше должен рассметриваться эффект ниндя, замтем эффект технинки 2 и, наконец, эффект тезнинки 1.




Каждый из эффектов в цепочке это набор инструкций, по мере выполнения которых и могут возникать дополнительные эффекты которые надо добавить в стек.

Надо добавить структуру снимка слудующую структуру

'current_effect': {like_e},
'effect_stack' : [
	like_e,
	like_e,
	like_e
]

like_e пердстовляет из себя набор эффект запечатанных либо в карту либо в какойто набор инструкций хранящихся внешге


Объект d приходящий от пользователя вместе со всеми запросами

{ u:
   { you: 'pA',
     opp: 'pB',
     table: 1,
     ses: 'J9ifyWZTw86tPM729ZVNwR70' } }

============

-> 'initGame'
